---
title: "Analysis Joined"
output: html_document
date: "2025-11-23"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
install.packages("bipartite")
```


 Cleaning and joining pollinator data 
 
```{r cars}
library(bipartite)
library(dplyr)
library(tidyr)
library(tibble)
veg <- read.csv("/Users/sydneyjames/OneDrive_UniversityofOregon/final_community_assembly-SJIN/data/veg.csv")
ints <- read.csv("/Users/sydneyjames/OneDrive_UniversityofOregon/final_community_assembly-SJIN/data/Holiday_PP_Interaction.csv")
#veg <- read.csv("/Users/isabellenollette/Desktop/final_community_assembly-SJIN/data/veg.csv")
#ints <- read.csv("/Users/isabellenollette/Desktop/final_community_assembly-SJIN/data/Holiday_PP_Interaction.csv")

veg_data <- veg %>%
  separate(col = Stand, into = c("Stand", "Loc"), sep = ":") %>%
  subset(Stand = c("604","605","607","611","700","702","704","705")) %>%
  subset(Site == 6) %>%
  subset(Transect != "Unenhanced") %>%
  subset(select = c("Stand", "Date", "Transect", "PlantGenusSpecies"))

ints1 <- ints %>%
  filter(Year == 2024) %>%
  separate(col = Stand, into = c("Year1", "Stand"), sep = "_") %>%
  separate(col = Stand, into = c("Stand", "Site"), sep = ":") %>%
  filter(Stand == "604" | Stand == "605" | Stand == "607" | Stand == "611" | Stand == "700" | Stand ==     "702" | Stand == "704" | Stand == "705")

both_data1 <- ints1 %>%
  inner_join(veg_data, by = "Stand", relationship = "many-to-many") %>%
  subset(select = -c(X, Year1, Site, Year, DoyStart)) %>%
  rename("Pollinator" = GenusSpecies, "Plant" = PlantGenusSpecies.y) 


#Remove extra plant data 
both_data1$PlantGenusSpecies.x <- NULL
#merge stand and sampling round 
both_data1$Standsr <- paste(both_data1$Stand, both_data1$Transect, both_data1$Date, sep = "_")

#Split all data into each stand
Stand_df <- split(both_data1, both_data1$Standsr, drop = FALSE)

# collect all Plants and Pollinator names: 
all_plants <- unique(unlist(lapply(Stand_df, function(df) df$Plant)))
all_pollinators <- unique(unlist(lapply(Stand_df, function(df) df$Pollinator)))

# Make each community into adjacency matrix stored in a list - for loop retaining no of rows/col

WHOLE_LIST <- vector("list", length = length(Stand_df))
for(i in seq_along(Stand_df)){
 ThisMix <- Stand_df[[i]] %>%
  ungroup() %>%
  complete(Plant = all_plants, Pollinator = all_pollinators, fill = list(interactions = 0)) %>%
  group_by(Pollinator, Plant) %>%
  summarize(interactions = n(), .groups = "drop") %>%
  pivot_wider(names_from = Pollinator, values_from = interactions, values_fill = 0) %>%
  column_to_rownames( var = "Plant")
  ThisMix[is.na(ThisMix)] <- 0
  ThisMix[ThisMix == 1] <- 0
  WHOLE_LIST[[i]] <- ThisMix
  names(WHOLE_LIST) <- names(Stand_df)
}

nested_values <- vector(length = length(WHOLE_LIST))
for(i in seq_along(WHOLE_LIST)){
  this.mat <- as.matrix(WHOLE_LIST[[i]])
  empty(this.mat, count = FALSE)
  rownames(this.mat) <- rownames(WHOLE_LIST[[i]])
  nodf <- networklevel(this.mat, index = "NODF")
  nested_values[[i]] <- round(nodf, digits = 3)
}

nested_values_st <- paste(names(WHOLE_LIST), nested_values, sep = "_")
head(nested_values_st)

```
Prepare Seed data to be joined to nestedness values:


```{r}
seed_count <- read.csv("/Users/sydneyjames/OneDrive_UniversityofOregon/final_community_assembly-SJIN/data/All_Cleaned_Data")

# rename mixes to match pollinator/data
seed_count$Seed_Mix <- as.character(seed_count$Seed_Mix)
seed_count$Seed_Mix[seed_count$Seed_Mix == 1] <- "Mix1"
seed_count$Seed_Mix[seed_count$Seed_Mix == 2] <- "Mix2"
seed_count$Seed_Mix[seed_count$Seed_Mix == 3] <- "Mix3"
seed_count$Seed_Mix[seed_count$Seed_Mix == 4] <- "Mix4"
seed_count$Seed_Mix[seed_count$Seed_Mix == 5] <- "Mix5"
seed_count$Seed_Mix[seed_count$Seed_Mix == 6] <- "Mix6"

# rename plants to match pollinator/data
seed_count$PlantGenusSpecies[seed_count$PlantGenusSpecies == "CLAAMO"] <- "Clarkia amoena" seed_count$PlantGenusSpecies[seed_count$PlantGenusSpecies ==ã€€"CLAPUR" ] <- "Clarkia purpurea"
seed_count$PlantGenusSpecies[seed_count$PlantGenusSpecies == "GILCAP"] <- "Gilia capitata"
seed_count$PlantGenusSpecies[seed_count$PlantGenusSpecies == "COLLIGRA"] <- "Collinsia grandiflora"
seed_count$PlantGenusSpecies[seed_count$PlantGenusSpecies == "MADGRA"] <- "Madia gracilis"
  
  
# rename columns and remove uneeded ones
seed_count1 <- seed_count %>%
  rename("Transect" = Seed_Mix, "Plant" = PlantGenusSpecies) %>%
  subset(select = -c(X, Treatment))
# paste stand and mix and split seed data by these combos 
seed_count1$Standsr1 <- paste(seed_count1$Stand, seed_count1$Transect, sep = "_")
seed_df <- split(seed_count1, seed_count1$Standsr1, drop = FALSE)
  
# inner_join by stand, plant and mix?

 

```

