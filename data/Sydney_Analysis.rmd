---
title: "Analysis Joined"
output: html_document
date: "2025-11-23"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


 Cleaning and joining pollinator data 
 
```{r cars}
install.packages("bipartite")
library(bipartite)
library(dplyr)
library(tidyr)
library(tibble)
veg <- read.csv("/Users/sydneyjames/OneDrive_UniversityofOregon/final_community_assembly-SJIN/data/veg.csv")
ints <- read.csv("/Users/sydneyjames/OneDrive_UniversityofOregon/final_community_assembly-SJIN/data/Holiday_PP_Interaction.csv")
#veg <- read.csv("/Users/isabellenollette/Desktop/final_community_assembly-SJIN/data/veg.csv")
#ints <- read.csv("/Users/isabellenollette/Desktop/final_community_assembly-SJIN/data/Holiday_PP_Interaction.csv")

veg_data <- veg %>%
  separate(col = Stand, into = c("Stand", "Loc"), sep = ":") %>%
  subset(Stand = c("604","605","607","611","700","702","704","705")) %>%
  subset(Site == 6) %>%
  subset(Transect != "Unenhanced") %>%
  subset(select = c("Stand", "Date", "Transect", "PlantGenusSpecies"))

ints1 <- ints %>%
  filter(Year == 2024) %>%
  separate(col = Stand, into = c("Year1", "Stand"), sep = "_") %>%
  separate(col = Stand, into = c("Stand", "Site"), sep = ":") %>%
  filter(Stand == "604" | Stand == "605" | Stand == "607" | Stand == "611" | Stand == "700" | Stand ==     "702" | Stand == "704" | Stand == "705")
  #subset(Stand = c("604","605","607","611","700","702","704","705"))

both_data1 <- ints1 %>%
  inner_join(veg_data, by = "Stand", relationship = "many-to-many") %>%
  subset(select = -c(X, Year1, Site, Year, DoyStart)) %>%
  rename("Pollinator" = GenusSpecies, "Plant" = PlantGenusSpecies.y) 


#Remove extra plant data 
both_data1$PlantGenusSpecies.x <- NULL
#merge stand and sampling round 
both_data1$Standsr <- paste(both_data1$Stand, both_data1$Date, both_data1$Transect, sep = "_")

#Split all data into each stand
Stand_df <- split(both_data1, both_data1$Standsr, drop = FALSE)

# Make each community into adjacency matrix stored in a list - for loop 

WHOLE_LIST <- vector("list", length = length(Stand_df))
for(i in seq_along(Stand_df)){
ThisMix <- Stand_df[[i]] %>%
  group_by(Pollinator, Plant) %>%
  summarize(interactions = n(), .groups = 'drop') %>%
  pivot_wider(names_from = Pollinator, values_from = interactions) %>%
  column_to_rownames( var = "Plant") 
  WHOLE_LIST[[i]] <- ThisMix
}

nested_values <- vector("list", length = length(WHOLE_LIST))
for(i in seq_along(WHOLE_LIST)){
  nodf  <- WHOLE_LIST[[i]] %>%
    networklevel(index = "nestedness")
    nested_values[[i]] <- nodf
}


```

